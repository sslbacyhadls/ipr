pipeline {
    agent {
        node {
        label 'maven'
        }
    }

    environment {
      VERSION = '0.0.1-SNAPSHOT'
    }

    stages {
        stage ('Get source code') {
            steps {
                git credentialsId: '21d4d238-46ac-4300-a7a7-b5ad76d3b839', url: 'https://github.com/sslbacyhadls/ipr'
            }
        }

        stage ('Build') {
            steps {
                dir ("demoRest"){
                sh 'mvn clean install'
                }
            }
        }

        stage ('Deploy to test'){
            steps {
                dir ("demoRest/target"){
                sh "sshpass -p "576189" scp demoRest-*.war ssh_user:test@test_env:/usr/local/tomcat/webapps/"
                }
            }
        }
    }
}
